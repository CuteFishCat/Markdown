#  网络
##  A类地址的范围  1-126.X.Y.Z  

一个网络中主机最大数=2^主机ID位数（32-网络ID位数）-2  

网络数=2^可变网络ID位=2^7  

1600万  

网络ID位为高8位，主机ID位为24  

格式  0xxxxxxx.X.Y.Z  

最小  00000000   0  

最大  01111111    127  

114.114.114.114  中国联通（南京）   A类地址  

##  B类地址的范围128-191.x.y.z  

网络ID位为高16位，主机ID位为16  

网络数=2^可变网络ID位=2^14  

65534  

格式  10xxxxxx.X.Y.Z  
 
 最小  10000000. 128  

最大  10111111. 191  

##  C类地址的范围   
  192-223.x.y.z  

网络ID位为高24位，主机ID位为8  

254  个

格式  110xxxxx.x.y.z  

最小  11000000  192  

最大  11011111   223  

##  D类地址的范围      224-239.x.y.z  

多播地址  

格式  1110xxxx.x.y.z  

##  E 类地址的范围         240-254.x.y.z  

格式   11110xxx.  

240-254.x.y.z    

==  


无类域间路由CIDR:网络id位数不确定, 0--32 

确定网络ID和主机ID的位数    
   netmask子网掩码     

子网掩码   :  
 32bit 二进制, 对应于网络ID位为1，对应于主机ID位为0 
  网络ID在高位  主机ID在低位  

CIDR表示法：IP/网络ID位数
00000000  0  

10000000  128  

11000000  192  

11100000  224  

11110000  240  

11111000  248  

11111100  252  

11111110  254  

11111111  255   

###  例如：255.255.224.0 
主机ID为：2^5+8 -2=2^13-2  

CIDR表示法   10.0.0.100/19       

例如   203.110.200.199/22   

1. 主机数?      1022        2^10-2
2. netmask?     255.255.252.0（11111111.11111111.11111100.000000000  

3. 网络ID值?    

 网络ID值=IP与子网掩码
203.110.200.199  

203.110.110010 00.199

与192.168.34.6  

 255.255.255.0

网络ID值192.168.34.0/24

 0与1=0
 0与0=0
 1与0=0
 1与1=1  

==
203.110.110010 00.199  

255.255.111111 00.00000000   

203.110.110010 00.0/22  
 203.110.200.0/22  

==

判断A和B是否在一个网段  

A  IP地址 192.168.1.100 
     子网掩码 255.255.255.0
 网络ID192.168.1.0  

B   IP地址192.168.2.100 
    子网掩码255.255.0.0  

 网络ID  192.168.2.0    
不在  

==
A 172.18.0.100   
255.0.0.0       
 172.18.0.0/16      

B 172.18.0.123        
 255.255.255.0           
 172.18.0.0/24    

互相与，都一样。就在一个网关 网段，，就能互相通  

==
100.123.199.124/20
1. 主机数  2^12-2 
2. 子网掩码 255.255.240.0  
3. 网络ID:100.123.192.0/20
4. 最小和最大IP:100.123.192.1 --- 100.123.207.254  

100.123.1100 000 .0000000.最小  

100.123.1111 1111.11111110  最大  

计算过程
100.123.11000111.124  

255.255.240.0   

100.123.1100 0000.1   

100.123.1100 1111.254     

== 

在不在一个网络  

123.200.233.100/23  
123.200.235.100/23  


00000001   

00000010  

00000100  

00001000  

00010000  

00100000  

01000000  

10000000   

1.  划分子网：一个大网划分成多个小网，网络ID位变多，主机ID位才变少，网络ID向主机ID借位N,
分成2^N个小网

10.0.0.1--10.255.255.254  
10.00 000000.0.0

10.00 000000.0.0 10.0.0.0/10  

10.01 000000.0.0 10.64.0.0/10  

10.10 000000.0.0 10.128.0.0/10  

10.11 000000.0.0 10.192.0.0/10  


10.0 0000000.0.0 10.0.0.0/9   

10.1 0000000.0.0 10.128.0.0/9   

== 
10.0.0.0/8 给32省份划分各自子网    

借5位         2^N=32   N=5        
 网络ID数  8+5=13
1. 子网子网掩码 255.248.0.0 
2. 最小子网，最大子网的网络ID  

10.00000  000.0.0       10.0.0.0/13  

10.11111  000.0.0          10.248.0.0/13
3. 每个子网主机数？2^19-2  

4. 第20个子网分给河南使用，最小IP  10.152.0.1，  
最大IP范围 10.159.255.254

10.10011  000.0.1              10.152.0.1   
10.10011  111.255.254      10.159.255.254  

==
# 公式：
1. 一个网络中主机最大数=2^主机ID位数(32-网络ID位数)-2=2^(32-网络ID位数)-2
2. 网络数=2^可变网络ID位
3. CIDR表示法：IP/网络ID位数
4. 网络ID值=IP与子网掩码
5. 划分子网：一个大网划分成多个小网，网络ID位变多，主机ID位才变少，网络ID向主机ID借位N,分成2^N个小网
6. 合并超网：多个小网合并成一个大网，主机ID向网络ID借位   

###  河南省10.152.0.0/13 给15个地市，划分各自子网 2^N>=15 N=4
1. 子网子网掩码   17个1         255.255.128.0
2. 最小子网，最大子网的网络ID

 最小  10.10011  000.0  0000000.0       10.152.0.0/17  

最大    10.10011  111.1  0000000.0       10.159.128.0/17

3. 每个子网主机数？ 2^(32-17)-2 
4. 最大子网的最小IP，最大IP范围   
10.159.128.1-10.159.255.254

10.10011  111.1  0000000.0  

10.10011  111.1  0000000.1        10.159.128.1   

10.10011  111.1  1111111.254     10.159.255.254  

==
 ##  河南省10.152.0.0/13 给87个区县，划分各自子网  
   2^N>=87  N=6  

1. 子网子网掩码          19个1       255.255.224.0
2. 最小子网，最大子网的网络ID  

最小 10.10011 000.000 00000.0    10.152.0.0/19                
最大 10.10011 111.111  00000.0     10.159.2240/19  

3. 每个子网主机数？2^(32-19)-2
4. 最大子网的最小IP，最大IP范围  

10.10011 111.111  00000.0    

10.10011111.11100000 .1          10.159.224.1    
10.10011111.11111111.254         10.159.255.254  

==
6. 合并超网：多个小网合并成一个大网，主机ID向网络ID借位  

220.78.10101 000.0                220.78.168.0  

220.78.10101 001.0                220.78.169.0

220.78.10101 111.0

220.78.168.0/21

路由表：  

目标网络ID：目标IP所在网络ID    

接口：本设备要发送数据包到目标，从哪个接口发送出来，才能到达  

网关：到达目标网络，需要将数据交给下一个路口哪个接口的对应的IP
#  路由
第一种:  

route add -net 172.16.6.0 netmask 255.255.255.0 gw 172.16.2.254 dev eth0  

 增加一条网络172.16.6.0/24 经过172.16.2.254 eth0 

 -net增加网络 -host增加主机 netmask 子网掩码 gw 网关 dev 装置,设备,这里是你的网卡名

route del gw 172.16.2.254 /删除默认网关172.16.2.254    

route del -net 172.16.86.0/24 /删除默认网络172.16.86.0  

route  显示当前路由表  

常用的是这种方式,但有时你在删除或一条软路由时会不起作用,会有什么提示:  

SIOCADDRT: 无法连接网络  

所以这时用如下的这种方法就可以了   


第二种:  
实现的功能和上面的一样  

ip route add 172.16.6.0/24 via 172.16.2.254 dev eth0  

ip route del gw 172.16.2.254  

ip route del 172.16.6.0/24 dev eth0  

ip route

删除的方法：  

添加路由:
route add -  net 10.0.0.0 netmask 255.0.0.0 dev eth0  

删除路由： route del -net 10.0.0.0 netmask 255.0.0.0 dev eth0  

添加默认路由：route add default gw 10.0.0.1  

删除默认路由：route del default gw 10.0.0.1  

或者route del default

##  二：在linux下设置永久路由的方法：
1. 在/etc/rc.local里添加  

方法： 
route add -net 192.168.3.0/24 dev eth0  

route add -net 192.168.2.0/24 gw 192.168.2.254


2. 在/etc/sysconfig/network里添加到末尾  

方法：GATEWAY=gw-ip 或者 GATEWAY=gw-dev


3. /etc/sysconfig/static-routes : (没有static-routes的话就手动建立一个这样的文件)  

any net 192.168.3.0/24 gw 192.168.3.254   

any net 10.250.228.128 netmask 255.255.255.192 gw 10.250.228.129  

 
4. 开启 IP 转发：  

 echo "1" >/proc/sys/net/ipv4/ip_forward (临时)  

 vi /etc/sysctl.conf --> net.ipv4.ip_forward=1 (永久开启)

 #   实验
 使用A主机192.168.1.2能够ping通E主机192.168.4.2，这两台机能够通信。  

操作思路：  

1. 在主机B上设置默认路由下一跳为192.168.2.2，并开启路由转发功能；  

2. 在主机C上设置2条静态路由，分别去192.168.1.0/24网段的下一跳为192.168.2.1，去192.168.4.0/24网段的下一跳为192.168.3.2，并开启路由转发功能  

3. 在主机D上设置默认路由下一跳为192.168.3.1，并开启路由转发功能。

操作记录：  

1. A主机上操作：ip为192.168.1.2，设置网关为192.168.1.1
#route add default gw 192.168.1.1
2. B主机上操作：第一块网卡为192.168.1.1，第二块网卡为192.168.2.1  

 ifconfig eth0 192.168.1.1  

ifconfig eth1 192.168.2.1    
 可以在一块网卡上设置两个ip，比如是eth0，eth0:0  

B主机设置默认路由，下一跳为192.168.2.2  

route add default gw 192.168.2.2  

B主机开启路由转发功能  

 echo 1 > /proc/sys/net/ipv4/ip_forward    

  临时转发，可以在/etc/sysctl.conf里设置永久转发
3. C主机上操作：第一块网卡为192.168.2.2，第二块网卡为192.168.3.1  

ifconfig eth0 192.168.2.2  

ifconfig eth1 192.168.3.1     
 
 如果就一块网卡，可以设置ifconfig eth0:0 192.168.3.1
C主机设置2条默认路由  

route add -net 192.168.1.0/24 gw 192.168.2.1  

route add -net 192.168.4.0/24 gw 192.168.3.2  

C主机开启路由转发功能  

echo 1 > /proc/sys/net/ipv4/ip_forward  

4. D主机上操作：第一块网卡为192.168.3.2，第二块网卡为192.168.4.1  

ifconfig eth0 192.168.3.2  

 ifconfig eth1 192.168.4.1  

D主机设置默认路由，下一跳为192.168.3.1  

route add default gw 192.168.3.1  

D主机开启路由转发功能  

 echo 1 > /proc/sys/net/ipv4/ip_forward  

5）E主机上操作：ip为192.168.4.2，设置网关为192.168.4.1  

 route add default gw 192.168.4.1
